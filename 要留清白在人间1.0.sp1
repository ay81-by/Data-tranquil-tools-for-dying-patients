<#
.SYNOPSIS
    æ•°æ®é”€æ¯å·¥å…· - Windows PowerShellç‰ˆæœ¬
.DESCRIPTION
    è­¦å‘Šï¼šæ­¤è„šæœ¬ä¼šå½»åº•åˆ é™¤è®¾å¤‡ä¸Šçš„æ‰€æœ‰æ•°æ®ï¼
    ä¸“ä¸ºç»ç—‡æ‚£è€…/ä¸´ç»ˆè€…è®¾è®¡ï¼Œåœ¨äº²å‹è§è¯ä¸‹å®‰å…¨æ¸…é™¤å­˜å‚¨æ•°æ®ã€‚
.NOTES
    ç‰ˆæœ¬: 1.0
    ä½œè€…: [é˜¿ä½™81]
    æ³•å¾‹å£°æ˜: ä»…é™åˆæ³•åŒ»ç–—åœºæ™¯ä½¿ç”¨ï¼Œä½¿ç”¨è€…éœ€è‡ªè¡Œæ‰¿æ‹…é£é™©
#>

#region è¯­è¨€å®šä¹‰å’Œç¿»è¯‘å‡½æ•°
$LANG_DEFINITIONS = @{
    "zh" = "ä¸­æ–‡"
    "en" = "English"
    "es" = "EspaÃ±ol"
    "fr" = "FranÃ§ais"
    "ja" = "æ—¥æœ¬èª"
}

# å½“å‰è¯­è¨€ä»£ç  (é»˜è®¤ä¸­æ–‡)
$LANG = "zh"

function Get-Translation {
    param(
        [string]$LangCode,
        [string]$Key
    )

    switch ($LangCode + ":" + $Key) {
        "zh:warning" { return "æ­¤è„šæœ¬éœ€è¦ç®¡ç†å‘˜æƒé™æ‰§è¡Œ" }
        "zh:continue_prompt" { return "è¿™ä¸æ˜¯ä¸ªç©ç¬‘æ˜¯å¦è¦ç»§ç»­æ‰§è¡Œ? (y/n): " }
        "zh:invalid_choice" { return "æ— æ•ˆè¾“å…¥ï¼Œé€€å‡ºè„šæœ¬..." }
        "zh:countdown" { return "è¦ç•™æ¸…ç™½åœ¨äººé—´å¦‚åæ‚”è¯·é©¬ä¸Šé€€å‡º10ç§’åå¼€å§‹æ ¼æœº." }
        "zh:goodbye" { return "è¦ç•™æ¸…ç™½åœ¨äººé—´ï¼šèŠ‚å“€" }
        "zh:formatting" { return "æ­£åœ¨æ ¼æœº" }
        "zh:unmounting" { return "æ­£åœ¨å¸è½½åˆ†åŒº..." }
        "zh:overwriting" { return "æ­£åœ¨è¦†å†™å­˜å‚¨æ•°æ®..." }
        "zh:destroying" { return "æ­£åœ¨ç ´ååˆ†åŒºè¡¨..." }
        "zh:deleting" { return "æ­£åœ¨åˆ é™¤æ‰€æœ‰æ–‡ä»¶..." }
        "zh:final_step" { return "æ­£åœ¨ç ´åå¼•å¯¼è®°å½•..." }
        "zh:power_off" { return "æ­£åœ¨å¼ºåˆ¶å…³æœº..." }
        "zh:self_destruct_warning_1" { return "ğŸš¨ è‡ªæ¯ç¨‹åºå¯åŠ¨ï¼šä»¥ä¸‹è„šæœ¬å°†è¢«åˆ é™¤:" }
        "zh:self_destruct_warning_2" { return "   $PSCommandPath" }
        "zh:self_destruct_countdown_3" { return "ğŸ•’ 3ç§’åå¼€å§‹åˆ é™¤..." }
        "zh:self_destruct_countdown_2" { return "ğŸ•’ 2ç§’åå¼€å§‹åˆ é™¤..." }
        "zh:self_destruct_countdown_1" { return "ğŸ•’ 1ç§’åå¼€å§‹åˆ é™¤..." }
        "zh:self_destruct_executing" { return "ğŸ’¥ æ­£åœ¨æ‰§è¡Œè‡ªæ¯..." }
        "zh:self_destruct_success" { return "âœ… è‡ªæ¯æˆåŠŸï¼è„šæœ¬å·²åˆ é™¤ã€‚" }
        "zh:self_destruct_failed" { return "âŒ è‡ªæ¯å¤±è´¥ï¼è„šæœ¬å¯èƒ½ä½äºåªè¯»ä½ç½®ã€‚" }

        "en:warning" { return "This script requires administrator privileges to run" }
        "en:continue_prompt" { return "This is not a joke. Continue anyway? (y/n): " }
        "en:invalid_choice" { return "Invalid input, exiting script..." }
        "en:countdown" { return "To leave a clear conscience, please exit now if you regret. Formatting will start in 10 seconds." }
        "en:goodbye" { return "Rest in peace" }
        "en:formatting" { return "Formatting device" }
        "en:unmounting" { return "Unmounting partitions..." }
        "en:overwriting" { return "Overwriting storage data..." }
        "en:destroying" { return "Destroying partition table..." }
        "en:deleting" { return "Deleting all files..." }
        "en:final_step" { return "Destroying boot records..." }
        "en:power_off" { return "Forcing system shutdown..." }
        "en:self_destruct_warning_1" { return "ğŸš¨ Self-destruct initiated: The following script will be deleted:" }
        "en:self_destruct_warning_2" { return "   $PSCommandPath" }
        "en:self_destruct_countdown_3" { return "ğŸ•’ Deleting in 3 seconds..." }
        "en:self_destruct_countdown_2" { return "ğŸ•’ Deleting in 2 seconds..." }
        "en:self_destruct_countdown_1" { return "ğŸ•’ Deleting in 1 second..." }
        "en:self_destruct_executing" { return "ğŸ’¥ Executing self-destruct..." }
        "en:self_destruct_success" { return "âœ… Self-destruct successful! Script deleted." }
        "en:self_destruct_failed" { return "âŒ Self-destruct failed! Script may be read-only." }

        default { return "[æœªç¿»è¯‘çš„æ–‡æœ¬: $Key]" }
    }
}
#endregion

#region è¿›åº¦æ¡å‡½æ•°
function Show-ProgressBar {
    param(
        [int]$Duration = 10
    )

    $i = 0
    $startTime = Get-Date

    while (((Get-Date) - $startTime).TotalSeconds -lt $Duration) {
        $percent = [math]::Min(100, [math]::Round(((Get-Date) - $startTime).TotalSeconds / $Duration * 100))
        $bar = "[" + ("=" * [math]::Min(50, [math]::Floor($percent / 2))) + 
               (" " * [math]::Max(0, 50 - [math]::Floor($percent / 2))) + "]"
        Write-Progress -Activity "å¤„ç†ä¸­" -Status "$percent% å®Œæˆ" -PercentComplete $percent
        Start-Sleep -Milliseconds 100
    }
    Write-Progress -Activity "å¤„ç†ä¸­" -Completed
}
#endregion

#region æ£€æŸ¥ç®¡ç†å‘˜æƒé™
function Test-Admin {
    $currentUser = [Security.Principal.WindowsIdentity]::GetCurrent()
    $principal = New-Object Security.Principal.WindowsPrincipal($currentUser)
    return $principal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
}

function Check-Admin {
    if (-not (Test-Admin)) {
        Get-Translation $LANG "warning"
        $choice = Read-Host (Get-Translation $LANG "continue_prompt")
        if ($choice -eq "y" -or $choice -eq "Y") {
            Get-Translation $LANG "countdown"
            Start-Sleep -Seconds 10
        } else {
            Get-Translation $LANG "invalid_choice"
            Self-Destruct
        }
    }
}
#endregion

#region è‡ªæ¯åŠŸèƒ½
function Self-Destruct {
    param(
        [string]$LangCode
    )

    Get-Translation $LangCode "self_destruct_warning_1"
    Write-Host
    Write-Host "   $PSCommandPath"
    Get-Translation $LangCode "self_destruct_warning_2"
    Write-Host

    for ($i = 3; $i -ge 1; $i--) {
        Get-Translation $LangCode "self_destruct_countdown_$i"
        Start-Sleep -Seconds 1
    }

    Get-Translation $LangCode "self_destruct_executing"
    try {
        Remove-Item -Path $PSCommandPath -Force -ErrorAction Stop
        if (-not (Test-Path $PSCommandPath)) {
            Get-Translation $LangCode "self_destruct_success"
        } else {
            Get-Translation $LangCode "self_destruct_failed"
        }
    } catch {
        Get-Translation $LangCode "self_destruct_failed"
    }
    exit 1
}
#endregion

#region ä¸»é”€æ¯å‡½æ•°
function Invoke-Destroy {
    param(
        [string]$LangCode
    )

    Get-Translation $LangCode "unmounting"
    # Windowsä¸‹æ— æ³•ç›´æ¥å¸è½½æ‰€æœ‰åˆ†åŒºï¼Œè¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿ
    Write-Host "æ³¨æ„: Windowsä¸‹æ— æ³•ç›´æ¥å¸è½½ç³»ç»Ÿåˆ†åŒº"
    Start-Sleep -Seconds 2

    Get-Translation $LangCode "overwriting"
    # æ¨¡æ‹Ÿè¦†å†™å­˜å‚¨æ•°æ® (å®é™…éœ€è¦ä¸“ä¸šå·¥å…·)
    for ($i = 1; $i -le 3; $i++) {
        Write-Host "æ­£åœ¨ç¬¬$iæ¬¡è¦†å†™æ•°æ®...(æ¨¡æ‹Ÿ)"
        Start-Sleep -Seconds 2
    }

    Get-Translation $LangCode "destroying"
    # æ¨¡æ‹Ÿç ´ååˆ†åŒºè¡¨
    Write-Host "æ­£åœ¨ç ´ååˆ†åŒºè¡¨...(æ¨¡æ‹Ÿ)"
    Start-Sleep -Seconds 2

    Get-Translation $LangCode "deleting"
    # æ¨¡æ‹Ÿåˆ é™¤æ–‡ä»¶
    Write-Host "æ­£åœ¨åˆ é™¤æ‰€æœ‰æ–‡ä»¶...(æ¨¡æ‹Ÿ)"
    Start-Sleep -Seconds 2

    Get-Translation $LangCode "final_step"
    # æ¨¡æ‹Ÿç ´åå¼•å¯¼è®°å½•
    Write-Host "æ­£åœ¨ç ´åå¼•å¯¼è®°å½•...(æ¨¡æ‹Ÿ)"
    Start-Sleep -Seconds 2

    Get-Translation $LangCode "power_off"
    # å…³æœºå‘½ä»¤
    Write-Host "æ­£åœ¨å¼ºåˆ¶å…³æœº..."
    Stop-Computer -Force
}
#endregion

#region ä¸»ç¨‹åº
function Main {
    # æ£€æŸ¥ç®¡ç†å‘˜æƒé™
    Check-Admin

    # æ¸…å±
    Clear-Host

    # æ˜¾ç¤ºè¿›åº¦æ¡
    Get-Translation $LANG "countdown"
    Show-ProgressBar -Duration 5
    Get-Translation $LANG "goodbye"

    # ç¡®è®¤æç¤º
    $choice = Read-Host (Get-Translation $LANG "continue_prompt")
    if ($choice -eq "y" -or $choice -eq "Y") {
        Get-Translation $LANG "countdown"
    } else {
        Get-Translation $LANG "invalid_choice"
        Self-Destruct -LangCode $LANG
    }

    # æ‰§è¡Œé”€æ¯æ“ä½œ
    Invoke-Destroy -LangCode $LANG
}

# æ‰§è¡Œä¸»ç¨‹åº
Main
#endregion